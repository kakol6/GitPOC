<?xml version = '1.0' encoding = 'UTF-8'?>
<!--
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
  Oracle JDeveloper BPEL Designer 
  
  Created: 
  Author:  AIAServiceConstructor Oracle SOA Toolbox
  Purpose: Requestor CreateDeliveryScheduleOTMReqABCS
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
--><process name="CreateDeliveryScheduleOTMReqABCSProcess" targetNamespace="ikea.com/system/iip/CreateDeliveryScheduleOTMReqABCSService/1.0/" xmlns="http://schemas.xmlsoap.org/ws/2003/03/business-process/" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:client="ikea.com/system/iip/CreateDeliveryScheduleOTMReqABCSService/1.0/" xmlns:ora="http://schemas.oracle.com/xpath/extension" xmlns:bpelx="http://schemas.oracle.com/bpel/extension" xmlns:bpws="http://schemas.xmlsoap.org/ws/2003/03/business-process/" xmlns:xp20="http://www.oracle.com/XSL/Transform/java/oracle.tip.pc.services.functions.Xpath20" xmlns:coreheader="ikea.com/system/iip/IIPHeader/1.0/" xmlns:corefault="ikea.com/system/iip/IIPFaultMessage/1.0/" xmlns:targetns="ikea.com/system/iip/DeliveryScheduleEnterpriseService/1.0/" xmlns:servreqelns="ikea.com/system/iip/CreateDeliveryScheduleOTMReqABCS/1.0/" xmlns:targetreqelns="ikea.com/cem/DeliverySchedule/1.0/" xmlns:targetreselns="ikea.com/cem/DeliverySchedule/1.0/" xmlns:targetfaultelns="ikea.com/system/iip/IIPHeader/1.0/" xmlns:ikeaeh="ikea.com/system/iip/IIPAsyncErrorHandlingService/1.0/" xmlns:aia="http://www.oracle.com/XSL/Transform/java/oracle.apps.aia.core.xpath.AIAFunctions" xmlns:oraext="http://www.oracle.com/XSL/Transform/java/oracle.tip.pc.services.functions.ExtFunc" xmlns:bpel2="http://docs.oasis-open.org/wsbpel/2.0/process/executable" xmlns:dvm="http://www.oracle.com/XSL/Transform/java/oracle.tip.dvm.LookupValue" xmlns:xdk="http://schemas.oracle.com/bpel/extension/xpath/function/xdk" xmlns:xref="http://www.oracle.com/XSL/Transform/java/oracle.tip.xref.xpath.XRefXPathFunctions" xmlns:ldap="http://schemas.oracle.com/xpath/extension/ldap" xmlns:ns2="http://schemas.xmlsoap.org/ws/2003/03/addressing" xmlns:ns3="urn:oasis:names:tc:xacml:2.0:context:schema:cd:04" xmlns:ns1="ikea.com/cem/OrderAndDelivery/DeliverySchedule/V0/" xmlns:ns4="http://xmlns.oracle.com/apps/otm/IntXmlService" xmlns:bpm="http://xmlns.oracle.com/bpmn20/extensions" xmlns:hwf="http://xmlns.oracle.com/bpel/workflow/xpath" xmlns:ids="http://xmlns.oracle.com/bpel/services/IdentityService/xpath" xmlns:ns5="http://xmlns.oracle.com/apps/otm" xmlns:bam="ikea.com/system/iip/bamAuditMessage/1.0/" xmlns:ess="http://xmlns.oracle.com/scheduler" xmlns:splunk="ikea.com/iip-splunk/SplunkPersonalInfo/V2/" xmlns:ns6="http://xmlns.oracle.com/apps/otm/TransmissionService" xmlns:ns7="http://xmlns.oracle.com/apps/otm/transmission/v6.4" xmlns:ns8="http://www.example.org" id="BpPrc0">
  <!-- 
    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
      PARTNERLINKS                                                      
      List of services participating in this BPEL process               
    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
  -->
  <bpelx:annotation>
    <bpelx:analysis>
      <bpelx:property name="wsdlFile">
        ../WSDLs/CreateDeliveryScheduleOTMReqABCSRef.wsdl
      </bpelx:property>
    </bpelx:analysis>
  </bpelx:annotation>
  <partnerLinks>
    <!-- 
      The 'client' role represents the requester of this service. It is 
      used for callback. The location and correlation information associated
      with the client role are automatically set using WS-Addressing.
    -->
    <partnerLink name="CreateDeliveryScheduleOTMReqABCS" partnerLinkType="client:CreateDeliveryScheduleOTMReqABCS" myRole="CreateDeliveryScheduleOTMReqABCSProvider"/>
    <partnerLink name="DeliveryScheduleEBS" partnerRole="DeliveryScheduleEBSResponse_Role" partnerLinkType="targetns:DeliveryScheduleEBSResponse_PL"/>
    <partnerLink myRole="IIPAsyncErrorHandlingProcessRequester" name="IIPAsyncErrorHandlingProcess" partnerRole="IIPAsyncErrorHandlingProcessProvider" partnerLinkType="ikeaeh:IIPAsyncErrorHandlingProcess"/>
    <partnerLink name="CreateDeliveryScheduleOTMRef1" partnerLinkType="ns6:CreateDeliveryScheduleOTMRef" partnerRole="CreateDeliveryScheduleOTMRef"/>
  </partnerLinks>
  <!-- 
    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
      VARIABLES                                                        
      List of messages and XML documents used within this BPEL process 
    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
  -->
  <variables>
    <!-- Reference to the message passed as input during initiation -->
    <variable name="CreateDeliveryScheduleReqMsg" messageType="client:CreateDeliveryScheduleRequestMessage"/>
    <variable name="SystemID" type="xsd:string"/>
    <variable name="Title" type="xsd:string"/>
    <variable name="EBM_HEADER" element="coreheader:EBMHeader"/>
    <variable name="InstanceID" type="xsd:string"/>
    <variable name="ServiceName" type="xsd:string"/>
    <variable name="TraceLogEnabled" type="xsd:boolean"/>
    <variable name="IsError" type="xsd:boolean"/>
    <variable name="IIPAsyncErrorHandlingProcessRequestMessage" messageType="ikeaeh:IIPAsyncErrorHandlingProcessRequestMessage"/>
    <variable name="SystemFaultVar" messageType="bpelx:RuntimeFaultMessage"/>
    <variable name="Invoke_DeliveryScheduleEBS_CreateDeliverySchedule_InputVariable" messageType="targetns:CreateDeliveryScheduleReqMsg"/>
    <variable name="Invoke_DeliveryScheduleEBS_CreateDeliverySchedule_OutputVariable" messageType="targetns:CreateDeliveryScheduleResMsg"/>
    <variable name="Invoke_CreateDeliveryScheduleOTMRef_InputVariable" messageType="ns6:publish"/>
    <variable name="Invoke_CreateDeliveryScheduleOTMRef_OutputVariable" messageType="ns6:publishResponse"/>
    <variable name="CreateDeliveryScheduleResMsg" messageType="client:CreateDeliveryScheduleResponseMessage"/>
    <variable name="isDESInvocationError" type="xsd:boolean"/>
    <variable name="BamAuditMessageSensorVariable" element="bam:bamAuditMessageRequest"/>
    <variable name="BamAuditMessageVariable" element="bam:bamAuditMessageRequest"/>
    <variable name="SplunkPersonalInfoVar" element="splunk:SplunkPersonalInfoRequest"/>
    <variable name="Assign_Title" type="xsd:string"/>
    <variable name="SubstitutionGroup" element="ns8:SubsitutionGroup"/>
  </variables>
  <!-- 
    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
     ORCHESTRATION LOGIC                                               
     Set of activities coordinating the flow of messages across the    
     services integrated within this business process                  
    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
  -->
  <sequence name="global_sequence" id="BpSeq0">
    <scope name="MainScope" id="BpScp0">
      <faultHandlers id="BpFhs0">
        <catch faultName="targetns:fault" faultVariable="IIPAsyncErrorHandlingProcessRequestMessage" id="BpCFt0">
          <sequence name="Sequence1" id="BpSeq1">
            <bpelx:exec name="TraceLog" version="1.5" id="BxExe0">
              java.lang.Boolean isTrace = (java.lang.Boolean)getVariableData("TraceLogEnabled");    
                     if (isTrace) se.oraclesoa.iip.bpel.functions.Tracer.traceFault("Fault", getVariableData("Title"), getVariableData("InstanceID"), getVariableData("ServiceName"));
            </bpelx:exec>
            <assign name="Assign_Error" id="BpAss0">
              <copy bpelx:insertMissingToData="yes" bpelx:ignoreMissingFromData="yes">
                <from variable="SystemFaultVar" part="code"/>
                <to variable="IIPAsyncErrorHandlingProcessRequestMessage" part="FaultMessage" query="/corefault:IIPFaultMessage/corefault:ErrorContext/corefault:ErrorCode"/>
              </copy>
              <copy bpelx:insertMissingToData="yes" bpelx:ignoreMissingFromData="yes">
                <from variable="SystemFaultVar" part="summary"/>
                <to variable="IIPAsyncErrorHandlingProcessRequestMessage" part="FaultMessage" query="/corefault:IIPFaultMessage/corefault:ErrorContext/corefault:ErrorText"/>
              </copy>
              <copy bpelx:insertMissingToData="yes" bpelx:ignoreMissingFromData="yes">
                <from variable="SystemFaultVar" part="detail"/>
                <to variable="IIPAsyncErrorHandlingProcessRequestMessage" part="FaultMessage" query="/corefault:IIPFaultMessage/corefault:ErrorContext/corefault:StackTrace"/>
              </copy>
              <copy>
                <from expression="true()"/>
                <to variable="IsError"/>
              </copy>
              <copy bpelx:insertMissingToData="yes" bpelx:ignoreMissingFromData="yes">
                <from expression="dvm:lookupValue('oramds:/apps/AIAMetaData/IIPComponents/dvm/Common/DeliverySchedule_IIP_EH_ALERT_LIST.dvm','AlertName','ITM_SHP_P_REQ_001','AlertValue','')"/>
                <to bpelx:language="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0" variable="IIPAsyncErrorHandlingProcessRequestMessage" part="FaultMessage" query="/corefault:IIPFaultMessage/corefault:AlertID"/>
              </copy>
            </assign>
          </sequence>
        </catch>
        <catch faultName="bpelx:remoteFault" faultVariable="SystemFaultVar" id="BpCFt1">
          <sequence name="RemoteFault_Sequence" id="BpSeq2">
            <bpelx:exec name="TraceLog" language="java" version="1.5" id="BxExe1">
              java.lang.Boolean isTrace = (java.lang.Boolean)getVariableData("TraceLogEnabled");   
                     if (isTrace) se.oraclesoa.iip.bpel.functions.Tracer.traceFault("RemoteFault", getVariableData("Title"), getVariableData("InstanceID"), getVariableData("ServiceName"));
            </bpelx:exec>
            <assign name="Assign_Error" id="BpAss1">
              <copy>
                <from expression="ora:processXSLT('Transformations/EBM_to_Fault.xsl',bpws:getVariableData('EBM_HEADER'))"/>
                <to variable="IIPAsyncErrorHandlingProcessRequestMessage" part="FaultMessage" query="/corefault:IIPFaultMessage"/>
              </copy>
              <copy>
                <from variable="SystemFaultVar" part="code"/>
                <to variable="IIPAsyncErrorHandlingProcessRequestMessage" part="FaultMessage" query="/corefault:IIPFaultMessage/corefault:ErrorContext/corefault:ErrorCode"/>
              </copy>
              <copy bpelx:insertMissingToData="yes" bpelx:ignoreMissingFromData="yes">
                <from variable="SystemFaultVar" part="summary"/>
                <to variable="IIPAsyncErrorHandlingProcessRequestMessage" part="FaultMessage" query="/corefault:IIPFaultMessage/corefault:ErrorContext/corefault:ErrorText"/>
              </copy>
              <copy bpelx:insertMissingToData="yes" bpelx:ignoreMissingFromData="yes">
                <from variable="SystemFaultVar" part="detail"/>
                <to variable="IIPAsyncErrorHandlingProcessRequestMessage" part="FaultMessage" query="/corefault:IIPFaultMessage/corefault:ErrorContext/corefault:StackTrace"/>
              </copy>
              <copy>
                <from expression="true()"/>
                <to variable="IsError"/>
              </copy>
              <copy bpelx:insertMissingToData="yes" bpelx:ignoreMissingFromData="yes">
                <from expression="dvm:lookupValue('oramds:/apps/AIAMetaData/IIPComponents/dvm/Common/DeliverySchedule_IIP_EH_ALERT_LIST.dvm','AlertName','ITM_SHP_P_REQ_002','AlertValue','')" bpelx:language="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"/>
                <to bpelx:language="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0" variable="IIPAsyncErrorHandlingProcessRequestMessage" part="FaultMessage" query="/corefault:IIPFaultMessage/corefault:AlertID"/>
              </copy>
            </assign>
          </sequence>
        </catch>
        <catch faultName="bpelx:bindingFault" faultVariable="SystemFaultVar" id="BpCFt2">
          <sequence name="BindingFault_Sequence" id="BpSeq3">
            <bpelx:exec name="TraceLog" language="java" version="1.5" id="BxExe2">
              java.lang.Boolean isTrace = (java.lang.Boolean)getVariableData("TraceLogEnabled");   
                     if (isTrace) se.oraclesoa.iip.bpel.functions.Tracer.traceFault("BindingFault", getVariableData("Title"), getVariableData("InstanceID"), getVariableData("ServiceName"));
            </bpelx:exec>
            <assign name="Assign_Error" id="BpAss2">
              <copy>
                <from expression="ora:processXSLT('Transformations/EBM_to_Fault.xsl',bpws:getVariableData('EBM_HEADER'))"/>
                <to variable="IIPAsyncErrorHandlingProcessRequestMessage" part="FaultMessage" query="/corefault:IIPFaultMessage"/>
              </copy>
              <copy>
                <from variable="SystemFaultVar" part="code"/>
                <to variable="IIPAsyncErrorHandlingProcessRequestMessage" part="FaultMessage" query="/corefault:IIPFaultMessage/corefault:ErrorContext/corefault:ErrorCode"/>
              </copy>
              <copy>
                <from variable="SystemFaultVar" part="summary"/>
                <to variable="IIPAsyncErrorHandlingProcessRequestMessage" part="FaultMessage" query="/corefault:IIPFaultMessage/corefault:ErrorContext/corefault:ErrorText"/>
              </copy>
              <copy bpelx:insertMissingToData="yes" bpelx:ignoreMissingFromData="yes">
                <from variable="SystemFaultVar" part="detail"/>
                <to variable="IIPAsyncErrorHandlingProcessRequestMessage" part="FaultMessage" query="/corefault:IIPFaultMessage/corefault:ErrorContext/corefault:StackTrace"/>
              </copy>
              <copy>
                <from expression="true()"/>
                <to variable="IsError"/>
              </copy>
              <copy bpelx:insertMissingToData="yes" bpelx:ignoreMissingFromData="yes">
                <from expression="dvm:lookupValue('oramds:/apps/AIAMetaData/IIPComponents/dvm/Common/DeliverySchedule_IIP_EH_ALERT_LIST.dvm','AlertName','ITM_SHP_P_REQ_003','AlertValue','')"/>
                <to bpelx:language="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0" variable="IIPAsyncErrorHandlingProcessRequestMessage" part="FaultMessage" query="/corefault:IIPFaultMessage/corefault:AlertID"/>
              </copy>
            </assign>
          </sequence>
        </catch>
        <catch faultName="bpelx:subLanguageExecutionFault" faultVariable="SystemFaultVar" id="BpCFt3">
          <sequence name="SubLanguageFault_Sequence" id="BpSeq4">
            <bpelx:exec name="TraceLog" language="java" version="1.5" id="BxExe3">
              java.lang.Boolean isTrace = (java.lang.Boolean)getVariableData("TraceLogEnabled");   
                     if (isTrace) se.oraclesoa.iip.bpel.functions.Tracer.traceFault("SubLanguageExecution", getVariableData("Title"), getVariableData("InstanceID"), getVariableData("ServiceName"));
            </bpelx:exec>
            <assign name="Assign_Error" id="BpAss3">
              <copy>
                <from expression="ora:processXSLT('Transformations/EBM_to_Fault.xsl',bpws:getVariableData('EBM_HEADER'))"/>
                <to variable="IIPAsyncErrorHandlingProcessRequestMessage" part="FaultMessage" query="/corefault:IIPFaultMessage"/>
              </copy>
              <copy>
                <from variable="SystemFaultVar" part="code"/>
                <to variable="IIPAsyncErrorHandlingProcessRequestMessage" part="FaultMessage" query="/corefault:IIPFaultMessage/corefault:ErrorContext/corefault:ErrorCode"/>
              </copy>
              <copy>
                <from variable="SystemFaultVar" part="summary"/>
                <to variable="IIPAsyncErrorHandlingProcessRequestMessage" part="FaultMessage" query="/corefault:IIPFaultMessage/corefault:ErrorContext/corefault:ErrorText"/>
              </copy>
              <copy bpelx:insertMissingToData="yes" bpelx:ignoreMissingFromData="yes">
                <from variable="SystemFaultVar" part="detail"/>
                <to variable="IIPAsyncErrorHandlingProcessRequestMessage" part="FaultMessage" query="/corefault:IIPFaultMessage/corefault:ErrorContext/corefault:StackTrace"/>
              </copy>
              <copy>
                <from expression="true()"/>
                <to variable="IsError"/>
              </copy>
              <copy bpelx:insertMissingToData="yes" bpelx:ignoreMissingFromData="yes">
                <from expression="dvm:lookupValue('oramds:/apps/AIAMetaData/IIPComponents/dvm/Common/DeliverySchedule_IIP_EH_ALERT_LIST.dvm','AlertName','ITM_SHP_P_REQ_004','AlertValue','')"/>
                <to bpelx:language="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0" variable="IIPAsyncErrorHandlingProcessRequestMessage" part="FaultMessage" query="/corefault:IIPFaultMessage/corefault:AlertID"/>
              </copy>
            </assign>
          </sequence>
        </catch>
        <catchAll id="BpCAl0">
          <sequence name="CheckAll_Sequence" id="BpSeq5">
            <bpelx:exec name="TraceLog" language="java" version="1.5" id="BxExe4">
              java.lang.Boolean isTrace = (java.lang.Boolean)getVariableData("TraceLogEnabled");   
                     if (isTrace) se.oraclesoa.iip.bpel.functions.Tracer.traceFault("CatchAll", getVariableData("Title"), getVariableData("InstanceID"), getVariableData("ServiceName"));
            </bpelx:exec>
            <assign name="Assign_Error" id="BpAss4">
              <copy>
                <from expression="ora:processXSLT('Transformations/EBM_to_Fault.xsl',bpws:getVariableData('EBM_HEADER'))"/>
                <to variable="IIPAsyncErrorHandlingProcessRequestMessage" part="FaultMessage" query="/corefault:IIPFaultMessage"/>
              </copy>
              <copy>
                <from expression="ora:getFaultName()"/>
                <to variable="IIPAsyncErrorHandlingProcessRequestMessage" part="FaultMessage" query="/corefault:IIPFaultMessage/corefault:ErrorContext/corefault:ErrorCode"/>
              </copy>
              <copy>
                <from expression="ora:getFaultAsString()"/>
                <to variable="IIPAsyncErrorHandlingProcessRequestMessage" part="FaultMessage" query="/corefault:IIPFaultMessage/corefault:ErrorContext/corefault:ErrorText"/>
              </copy>
              <copy bpelx:insertMissingToData="yes" bpelx:ignoreMissingFromData="yes">
                <from variable="SystemFaultVar" part="detail"/>
                <to variable="IIPAsyncErrorHandlingProcessRequestMessage" part="FaultMessage" query="/corefault:IIPFaultMessage/corefault:ErrorContext/corefault:StackTrace"/>
              </copy>
              <copy>
                <from expression="true()"/>
                <to variable="IsError"/>
              </copy>
              <copy bpelx:insertMissingToData="yes" bpelx:ignoreMissingFromData="yes">
                <from expression="dvm:lookupValue('oramds:/apps/AIAMetaData/IIPComponents/dvm/Common/DeliverySchedule_IIP_EH_ALERT_LIST.dvm','AlertName','ITM_SHP_P_REQ_005','AlertValue','')"/>
                <to bpelx:language="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0" variable="IIPAsyncErrorHandlingProcessRequestMessage" part="FaultMessage" query="/corefault:IIPFaultMessage/corefault:AlertID"/>
              </copy>
            </assign>
          </sequence>
        </catchAll>
      </faultHandlers>
      <sequence name="main_sequence" id="BpSeq6">
        <scope name="InitScope" id="BpScp1">
          <bpelx:annotation>
            <bpelx:general>
              <bpelx:property name="userLabel">InitScope</bpelx:property>
            </bpelx:general>
          </bpelx:annotation>
          <sequence name="ProcessRequestMsg" id="BpSeq7">
            <!-- Receive input from requestor. (Note: This maps to operation defined in CreateDeliveryScheduleOTMReqABCS.wsdl) -->
            <receive name="CreateDeliveryScheduleOTMReqABCS" partnerLink="CreateDeliveryScheduleOTMReqABCS" portType="client:CreateDeliveryScheduleOTMReqABCS" operation="CreateDeliverySchedule" variable="CreateDeliveryScheduleReqMsg" createInstance="yes" id="BpRcv0"/>
            <assign name="Transformation_substitutions" id="BpAss5">
              <bpelx:annotation>
                <bpelx:pattern>transformation</bpelx:pattern>
              </bpelx:annotation>
              <copy>
                <from expression="ora:doXSLTransformForDoc('../Transformations/Transformation_SubstitutionGroup.xsl', $CreateDeliveryScheduleReqMsg.parameter)"/>
                <to variable="SubstitutionGroup"/>
              </copy>
            </assign>
            <assign name="GetTitle" id="BpAss6">
              <copy>
                <from expression="concat('CreateDeliverySchedule-',bpws:getVariableData('SubstitutionGroup','/ns8:SubsitutionGroup/ns8:Title'))" bpelx:language="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"/>
                <to variable="Title"/>
              </copy>
              <copy>
                <from expression="ora:getInstanceId()"/>
                <to variable="InstanceID"/>
              </copy>
              <copy>
                <from expression="ora:getProcessId()"/>
                <to variable="ServiceName"/>
              </copy>
              <copy>
                <from expression="false()"/>
                <to variable="IsError"/>
              </copy>
              <copy>
                <from expression="ora:getPreference('tracingEnabled')"/>
                <to variable="TraceLogEnabled"/>
              </copy>
            </assign>
            <bpelx:exec name="SetTitle" language="java" version="1.5" id="BxExe5">
              oraext:setFlowInstanceTitle((String)getVariableData("Title"));
            </bpelx:exec>
            <scope name="BAMScope" bpelx:skipCondition="ora:getPreference('reportToBAM')='false'" id="BpScp2">
              <faultHandlers id="BpFhs1">
                <catchAll id="BpCAl1">
                  <empty name="Empty" id="BpEmp0"/>
                </catchAll>
              </faultHandlers>
              <sequence name="BAMSequence" id="BpSeq8">
                <assign name="Assign_BAMSensor_InputData" id="BpAss7">
                  <copy bpelx:insertMissingToData="yes">
                    <from expression="ora:getECID()"/>
                    <to bpelx:language="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0" variable="BamAuditMessageVariable" query="/bam:bamAuditMessageRequest/bam:bamAuditMessage/bam:technicalIdentifier"/>
                  </copy>
                  <copy bpelx:insertMissingToData="yes">
                    <from expression="'ITM'" bpelx:language="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"/>
                    <to bpelx:language="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0" variable="BamAuditMessageVariable" query="/bam:bamAuditMessageRequest/bam:bamAuditMessage/bam:source"/>
                  </copy>
                  <copy bpelx:insertMissingToData="yes">
                    <from expression="'IIP'"/>
                    <to bpelx:language="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0" variable="BamAuditMessageVariable" query="/bam:bamAuditMessageRequest/bam:bamAuditMessage/bam:target"/>
                  </copy>
                  <copy bpelx:insertMissingToData="yes">
                    <from expression="'ABCSRequestorReq'"/>
                    <to bpelx:language="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0" variable="BamAuditMessageVariable" query="/bam:bamAuditMessageRequest/bam:bamAuditMessage/bam:sourceType"/>
                  </copy>
                  <copy bpelx:insertMissingToData="yes">
                    <from expression="ora:getProcessId()"/>
                    <to bpelx:language="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0" variable="BamAuditMessageVariable" query="/bam:bamAuditMessageRequest/bam:bamAuditMessage/bam:serviceName"/>
                  </copy>
                  <copy bpelx:insertMissingToData="yes">
                    <from expression="'Received'"/>
                    <to bpelx:language="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0" variable="BamAuditMessageVariable" query="/bam:bamAuditMessageRequest/bam:bamAuditMessage/bam:status"/>
                  </copy>
                  <copy bpelx:insertMissingToData="yes">
                    <from expression="xp20:current-dateTime()"/>
                    <to bpelx:language="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0" variable="BamAuditMessageVariable" query="/bam:bamAuditMessageRequest/bam:bamAuditMessage/bam:IIPReceivedDate"/>
                  </copy>
                  <copy>
                    <from expression="''"/>
                    <to bpelx:language="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0" variable="BamAuditMessageVariable" query="/bam:bamAuditMessageRequest/bam:bamAuditMessage/bam:IIPForwardedDate"/>
                  </copy>
                  <copy bpelx:insertMissingToData="yes">
                    <from expression="'SOA'"/>
                    <to bpelx:language="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0" variable="BamAuditMessageVariable" query="/bam:bamAuditMessageRequest/bam:bamAuditMessage/bam:implementationType"/>
                  </copy>
                  <copy bpelx:insertMissingToData="yes">
                    <from expression="'RequestReply'" bpelx:language="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"/>
                    <to bpelx:language="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0" variable="BamAuditMessageVariable" query="/bam:bamAuditMessageRequest/bam:bamAuditMessage/bam:integrationType"/>
                  </copy>
                  <copy bpelx:insertMissingToData="yes">
                    <from expression="ora:getFlowId()"/>
                    <to bpelx:language="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0" variable="BamAuditMessageVariable" query="/bam:bamAuditMessageRequest/bam:bamAuditMessage/bam:instanceId"/>
                  </copy>
                  <copy bpelx:insertMissingToData="yes">
                    <from expression="'IIP'"/>
                    <to bpelx:language="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0" variable="BamAuditMessageVariable" query="/bam:bamAuditMessageRequest/bam:bamAuditMessage/bam:createdName"/>
                  </copy>
                  <copy bpelx:insertMissingToData="yes">
                    <from bpelx:language="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0" variable="BamAuditMessageVariable" query="/bam:bamAuditMessageRequest/bam:bamAuditMessage/bam:IIPReceivedDate"/>
                    <to bpelx:language="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0" variable="BamAuditMessageVariable" query="/bam:bamAuditMessageRequest/bam:bamAuditMessage/bam:creationDate"/>
                  </copy>
                  <copy bpelx:insertMissingToData="yes">
                    <from expression="'ITM_OIP_00010_DELIVERYSCHEDULE'" bpelx:language="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"/>
                    <to bpelx:language="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0" variable="BamAuditMessageVariable" query="/bam:bamAuditMessageRequest/bam:bamAuditMessage/bam:IKEAOERIntegrationContractName"/>
                  </copy>
                  <copy bpelx:insertMissingToData="yes">
                    <from expression="'od.del.des.DeliverySchedule'" bpelx:language="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"/>
                    <to bpelx:language="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0" variable="BamAuditMessageVariable" query="/bam:bamAuditMessageRequest/bam:bamAuditMessage/bam:IKEAOERServiceSpecificationName"/>
                  </copy>
                  <copy bpelx:insertMissingToData="yes">
                    <from expression="'1'" bpelx:language="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"/>
                    <to bpelx:language="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0" variable="BamAuditMessageVariable" query="/bam:bamAuditMessageRequest/bam:bamAuditMessage/bam:IKEAOERServiceSpecificationVersion"/>
                  </copy>
                  <copy bpelx:insertMissingToData="yes">
                    <from expression="'Entry'"/>
                    <to bpelx:language="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0" variable="BamAuditMessageVariable" query="/bam:bamAuditMessageRequest/bam:bamAuditMessage/bam:IKEAInvocationPoint"/>
                  </copy>
                  <copy>
                    <from expression="'ShipmentNo'" bpelx:language="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"/>
                    <to bpelx:language="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0" variable="BamAuditMessageVariable" query="/bam:bamAuditMessageRequest/bam:bamAuditMessage/bam:BusinessObjects/bam:BusinessObject/bam:BusinessIdentifiers/bam:BusinessIdentifier/bam:BKey"/>
                  </copy>
                  <copy bpelx:insertMissingToData="yes">
                    <from expression="bpws:getVariableData('SubstitutionGroup','/ns8:SubsitutionGroup/ns8:Title')" bpelx:language="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"/>
                    <to bpelx:language="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0" variable="BamAuditMessageVariable" query="/bam:bamAuditMessageRequest/bam:bamAuditMessage/bam:BusinessObjects/bam:BusinessObject/bam:BusinessIdentifiers/bam:BusinessIdentifier/bam:BValue"/>
                  </copy>
                </assign>
                <assign name="Assign_BAMSensors_trigger" id="BpAss8">
                  <copy>
                    <from bpelx:language="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0" variable="BamAuditMessageVariable"/>
                    <to bpelx:language="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0" variable="BamAuditMessageSensorVariable"/>
                  </copy>
                </assign>
              </sequence>
            </scope>
            <bpelx:exec name="TraceLog" language="java" version="1.5" id="BxExe6">
              java.lang.Boolean isTrace = (java.lang.Boolean)getVariableData("TraceLogEnabled");   
                     if (isTrace) se.oraclesoa.iip.bpel.functions.Tracer.startInstance(getVariableData("Title"), getVariableData("InstanceID"), getVariableData("ServiceName"));
            </bpelx:exec>
          </sequence>
        </scope>
        <scope name="EnrichScope" id="BpScp3">
          <bpelx:annotation>
            <bpelx:general>
              <bpelx:property name="userLabel">EnrichScope</bpelx:property>
            </bpelx:general>
          </bpelx:annotation>
          <sequence id="BpSeq9">
            <bpelx:exec name="TraceLog" language="java" version="1.5" id="BxExe7">
              java.lang.Boolean isTrace = (java.lang.Boolean)getVariableData("TraceLogEnabled");   
                     if (isTrace) se.oraclesoa.iip.bpel.functions.Tracer.traceEnrich(getVariableData("Title"), getVariableData("InstanceID"), getVariableData("ServiceName"));
            </bpelx:exec>
            <empty name="Empty" id="BpEmp1"/>
          </sequence>
        </scope>
        <scope name="TransformScope" id="BpScp4">
          <bpelx:annotation>
            <bpelx:general>
              <bpelx:property name="userLabel">TransformScope</bpelx:property>
            </bpelx:general>
          </bpelx:annotation>
          <sequence id="BpSeq10">
            <bpelx:exec name="TraceLog" language="java" version="1.5" id="BxExe8">
              java.lang.Boolean isTrace = (java.lang.Boolean)getVariableData("TraceLogEnabled");   
                     if (isTrace) se.oraclesoa.iip.bpel.functions.Tracer.traceTransform(getVariableData("Title"), getVariableData("InstanceID"), getVariableData("ServiceName"));
            </bpelx:exec>
            <assign name="Xform_CreateDeliveryScheduleRequestMessage_To_CreateDeliveryScheduleReqMessage" id="BpAss9">
              <bpelx:annotation>
                <bpelx:pattern>transformation</bpelx:pattern>
              </bpelx:annotation>
              <copy>
                <from expression="ora:doXSLTransformForDoc('../Transformations/Xform_CreateDeliveryScheduleRequestMessage_To_CreateDeliveryScheduleReqMsg.xsl', $CreateDeliveryScheduleReqMsg.parameter)"/>
                <to variable="Invoke_DeliveryScheduleEBS_CreateDeliverySchedule_InputVariable" part="CreateDeliveryScheduleEBM"/>
              </copy>
            </assign>
            <assign name="Transform_Header" id="BpAss10">
              <bpelx:annotation>
                <bpelx:pattern>transformation</bpelx:pattern>
              </bpelx:annotation>
              <copy>
                <from expression="ora:doXSLTransformForDoc('../Transformations/Xform_EBMHeader.xsl', $CreateDeliveryScheduleReqMsg.parameter)"/>
                <to variable="EBM_HEADER"/>
              </copy>
            </assign>
            <!--assign name="Xform_CreateDeliveryScheduleRequestMessage_To_CreateDeliveryScheduleReqMsg">
          <bpelx:annotation>
            <bpelx:pattern>transformation</bpelx:pattern>
          </bpelx:annotation>
          <copy>
            <from expression="ora:doXSLTransformForDoc('../Transformations/Xform_CreateDeliveryScheduleRequestMessage_To_CreateDeliveryScheduleReqMsg.xsl', $CreateDeliveryScheduleReqMsg.parameter)"/>
            <to variable="Invoke_DeliveryScheduleEBS_CreateDeliverySchedule_InputVariable"
                part="CreateDeliveryScheduleEBM"/>
          </copy>
        </assign-->
            <sequence name="Sequence2" id="BpSeq11">
              <assign name="Xform_Splunk" id="BpAss11">
                <bpelx:annotation>
                  <bpelx:pattern>transformation</bpelx:pattern>
                </bpelx:annotation>
                <copy>
                  <from expression="ora:doXSLTransformForDoc('../Transformations/Xform_Splunk_New.xsl', $CreateDeliveryScheduleReqMsg.parameter)"/>
                  <to variable="SplunkPersonalInfoVar"/>
                </copy>
              </assign>
              <assign name="Assign_Splunk" id="BpAss12">
                <copy>
                  <from expression="'SOA'"/>
                  <to bpelx:language="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0" variable="SplunkPersonalInfoVar" query="/splunk:SplunkPersonalInfoRequest/splunk:Technology"/>
                </copy>
                <copy>
                  <from expression="ora:getCompositeName()"/>
                  <to bpelx:language="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0" variable="SplunkPersonalInfoVar" query="/splunk:SplunkPersonalInfoRequest/splunk:IntegrationName"/>
                </copy>
                <copy>
                  <from expression="ora:getECID()"/>
                  <to bpelx:language="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0" variable="SplunkPersonalInfoVar" query="/splunk:SplunkPersonalInfoRequest/splunk:ECID"/>
                </copy>
                <copy>
                  <from expression="ora:getFlowId()"/>
                  <to bpelx:language="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0" variable="SplunkPersonalInfoVar" query="/splunk:SplunkPersonalInfoRequest/splunk:FlowId"/>
                </copy>
              </assign>
              <bpelx:exec import="com.ikea.itm.splunkhec.SplunkHecAdaptor" id="BxExe9"/>
              <bpelx:exec import="oracle.xml.parser.v2.XMLElement" id="BxExe10"/>
              <bpelx:exec import="java.sql.Timestamp" id="BxExe11"/>
              <bpelx:exec import="java.util.Date" id="BxExe12"/>
              <bpelx:exec name="Splunk_Call" version="1.5" id="BxExe13">
                try{                      
        
XMLElement integrationNameVar = (XMLElement) getVariableData("SplunkPersonalInfoVar","/splunk:SplunkPersonalInfoRequest/splunk:IntegrationName");                                            
String integrationName = integrationNameVar.getTextContent();                  
addAuditTrailEntry("IntegrationName : "+ integrationName);                  
             
XMLElement technologyVar = (XMLElement) getVariableData("SplunkPersonalInfoVar","/splunk:SplunkPersonalInfoRequest/splunk:Technology");                
String technology = technologyVar.getTextContent();                            
addAuditTrailEntry("Technology : " + technology);              
             
XMLElement ecidVar = (XMLElement) getVariableData("SplunkPersonalInfoVar","/splunk:SplunkPersonalInfoRequest/splunk:ECID");                                            
String ecid = ecidVar.getTextContent();                  
addAuditTrailEntry("ECID : "+ ecid);                 
                
XMLElement idVar = (XMLElement) getVariableData("SplunkPersonalInfoVar","/splunk:SplunkPersonalInfoRequest/splunk:FlowId");                                            
String id = idVar.getTextContent();                  
addAuditTrailEntry("FlowId : "+ id);                 
                            
XMLElement emailCountVar = (XMLElement) getVariableData("SplunkPersonalInfoVar","/splunk:SplunkPersonalInfoRequest/splunk:EmailCount");                                            
int emailCount = Integer.parseInt(emailCountVar.getTextContent());                 
addAuditTrailEntry("EmailCount : "+ emailCount);                 
                
XMLElement faxNumberCountVar = (XMLElement) getVariableData("SplunkPersonalInfoVar","/splunk:SplunkPersonalInfoRequest/splunk:FaxNumberCount");                                            
int faxNumberCount = Integer.parseInt(faxNumberCountVar.getTextContent());                 
addAuditTrailEntry("FaxNumberCount : "+ faxNumberCount);                 
                     
                
XMLElement nameCountVar = (XMLElement) getVariableData("SplunkPersonalInfoVar","/splunk:SplunkPersonalInfoRequest/splunk:NameCount");                                            
int nameCount = Integer.parseInt(nameCountVar.getTextContent());                 
addAuditTrailEntry("NameCount : "+ nameCount);                 
                
XMLElement phoneNumberCountVar = (XMLElement) getVariableData("SplunkPersonalInfoVar","/splunk:SplunkPersonalInfoRequest/splunk:PhoneNumberCount");                                            
int phoneNumberCount = Integer.parseInt(phoneNumberCountVar.getTextContent());                 
addAuditTrailEntry("PhoneNumberCount : "+ phoneNumberCount);             
                                   
Timestamp timestamp = new Timestamp(new Date().getTime());                           
addAuditTrailEntry("Splunk invocation Timestamp : " +timestamp);                          
                          
SplunkHecAdaptor splunkHecAdaptor = new SplunkHecAdaptor();                                
String result = splunkHecAdaptor.logPersonalDataCount(technology,integrationName,ecid,id,0,0,0,emailCount,faxNumberCount,nameCount,phoneNumberCount);          
   
addAuditTrailEntry("response received from splunk : " + result);          
}catch(Exception e){                           
System.out.println("exception" +e.getMessage());                           
addAuditTrailEntry(e);                           
                           
}
              </bpelx:exec>
            </sequence>
          </sequence>
        </scope>
        <scope name="OperateScope" id="BpScp5">
          <bpelx:annotation>
            <bpelx:general>
              <bpelx:property name="userLabel">OperateScope</bpelx:property>
            </bpelx:general>
          </bpelx:annotation>
          <faultHandlers id="BpFhs2">
            <catchAll id="BpCAl2"><sequence name="Sequence3" id="BpSeq12"><assign name="AssignDESInvocationError" id="BpAss13"><copy><from expression="true()"/><to variable="isDESInvocationError"/></copy><copy><from expression="ora:processXSLT('Transformations/EBM_to_Fault.xsl',bpws:getVariableData('EBM_HEADER'))"/><to variable="IIPAsyncErrorHandlingProcessRequestMessage" part="FaultMessage" query="/corefault:IIPFaultMessage"/></copy><copy bpelx:insertMissingToData="yes" bpelx:ignoreMissingFromData="yes"><from expression="ora:getFaultName()"/><to variable="IIPAsyncErrorHandlingProcessRequestMessage" part="FaultMessage" query="/corefault:IIPFaultMessage/corefault:ErrorContext/corefault:ErrorCode"/></copy><copy bpelx:insertMissingToData="yes" bpelx:ignoreMissingFromData="yes"><from expression="ora:getFaultAsString()"/><to variable="IIPAsyncErrorHandlingProcessRequestMessage" part="FaultMessage" query="/corefault:IIPFaultMessage/corefault:ErrorContext/corefault:ErrorText"/></copy></assign><scope name="BAMScopeWhenDESProviderFailed" bpelx:skipCondition="ora:getPreference('reportToBAM')='false'" id="BpScp6">
      <faultHandlers id="BpFhs3">
         <catchAll id="BpCAl3">
            <empty name="Empty" id="BpEmp2"/>
         </catchAll>
      </faultHandlers>
      <sequence name="BAMSequence" id="BpSeq13">
         <assign name="Assign_BAMSensor_InputData" id="BpAss14">
            <copy>
               <from expression="'IIP'"/>
               <to bpelx:language="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0" variable="BamAuditMessageVariable" query="/bam:bamAuditMessageRequest/bam:bamAuditMessage/bam:source"/>
            </copy>
            <copy>
               <from expression="'ITM'" bpelx:language="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"/>
               <to bpelx:language="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0" variable="BamAuditMessageVariable" query="/bam:bamAuditMessageRequest/bam:bamAuditMessage/bam:target"/>
            </copy>
            <copy>
               <from expression="'ABCSRequestorRes'"/>
               <to bpelx:language="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0" variable="BamAuditMessageVariable" query="/bam:bamAuditMessageRequest/bam:bamAuditMessage/bam:sourceType"/>
            </copy>
            <copy>
               <from expression="'Failed'"/>
               <to bpelx:language="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0" variable="BamAuditMessageVariable" query="/bam:bamAuditMessageRequest/bam:bamAuditMessage/bam:status"/>
            </copy>
            <copy>
               <from expression="''"/>
               <to bpelx:language="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0" variable="BamAuditMessageVariable" query="/bam:bamAuditMessageRequest/bam:bamAuditMessage/bam:IIPReceivedDate"/>
            </copy>
            <copy>
               <from expression="xp20:current-dateTime()"/>
               <to bpelx:language="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0" variable="BamAuditMessageVariable" query="/bam:bamAuditMessageRequest/bam:bamAuditMessage/bam:IIPForwardedDate"/>
            </copy>
            <copy>
               <from bpelx:language="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0" variable="BamAuditMessageVariable" query="/bam:bamAuditMessageRequest/bam:bamAuditMessage/bam:IIPForwardedDate"/>
               <to bpelx:language="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0" variable="BamAuditMessageVariable" query="/bam:bamAuditMessageRequest/bam:bamAuditMessage/bam:creationDate"/>
            </copy>
            <copy>
               <from expression="'Exit'"/>
               <to bpelx:language="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0" variable="BamAuditMessageVariable" query="/bam:bamAuditMessageRequest/bam:bamAuditMessage/bam:IKEAInvocationPoint"/>
            </copy>
         </assign>
         <assign name="Assign_BAMSensors_trigger" id="BpAss15">
            <copy>
               <from bpelx:language="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0" variable="BamAuditMessageVariable"/>
               <to bpelx:language="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0" variable="BamAuditMessageSensorVariable"/>
            </copy>
         </assign>
      </sequence>
   </scope></sequence></catchAll>
          </faultHandlers>
          <sequence id="BpSeq14">
            <bpelx:exec name="TraceLog" language="java" version="1.5" id="BxExe14">
              java.lang.Boolean isTrace = (java.lang.Boolean)getVariableData("TraceLogEnabled");   
                     if (isTrace) se.oraclesoa.iip.bpel.functions.Tracer.enterOperate(getVariableData("Title"), getVariableData("InstanceID"), getVariableData("ServiceName"), getVariableData("EBM_HEADER"));
            </bpelx:exec>
            <assign name="Assign_Header" id="BpAss16">
              <bpelx:insertBefore>
                <bpelx:from variable="EBM_HEADER" query="/coreheader:EBMHeader"/>
                <bpelx:to variable="Invoke_DeliveryScheduleEBS_CreateDeliverySchedule_InputVariable" part="CreateDeliveryScheduleEBM" query="/ns1:CreateDeliveryScheduleEBM/ns1:DataArea"/>
              </bpelx:insertBefore>
            </assign>
            <invoke name="Invoke_DeliveryScheduleEBS" inputVariable="Invoke_DeliveryScheduleEBS_CreateDeliverySchedule_InputVariable" partnerLink="DeliveryScheduleEBS" portType="targetns:DeliveryScheduleEBS" operation="CreateDeliverySchedule" outputVariable="Invoke_DeliveryScheduleEBS_CreateDeliverySchedule_OutputVariable" bpelx:invokeAsDetail="no" id="BpInv0"/>
            <scope name="BAMScope" bpelx:skipCondition="ora:getPreference('reportToBAM')='false'" id="BpScp7">
              <faultHandlers id="BpFhs4">
                <catchAll id="BpCAl4">
                  <empty name="Empty" id="BpEmp3"/>
                </catchAll>
              </faultHandlers>
              <sequence name="BAMSequence" id="BpSeq15">
                <assign name="Assign_BAMSensor_InputData" id="BpAss17">
                  <copy>
                    <from expression="'IIP'"/>
                    <to bpelx:language="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0" variable="BamAuditMessageVariable" query="/bam:bamAuditMessageRequest/bam:bamAuditMessage/bam:source"/>
                  </copy>
                  <copy>
                    <from expression="'ITM'" bpelx:language="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"/>
                    <to bpelx:language="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0" variable="BamAuditMessageVariable" query="/bam:bamAuditMessageRequest/bam:bamAuditMessage/bam:target"/>
                  </copy>
                  <copy>
                    <from expression="'ABCSRequestorRes'"/>
                    <to bpelx:language="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0" variable="BamAuditMessageVariable" query="/bam:bamAuditMessageRequest/bam:bamAuditMessage/bam:sourceType"/>
                  </copy>
                  <copy>
                    <from expression="'Sent'"/>
                    <to bpelx:language="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0" variable="BamAuditMessageVariable" query="/bam:bamAuditMessageRequest/bam:bamAuditMessage/bam:status"/>
                  </copy>
                  <copy>
                    <from expression="''"/>
                    <to bpelx:language="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0" variable="BamAuditMessageVariable" query="/bam:bamAuditMessageRequest/bam:bamAuditMessage/bam:IIPReceivedDate"/>
                  </copy>
                  <copy>
                    <from expression="xp20:current-dateTime()"/>
                    <to bpelx:language="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0" variable="BamAuditMessageVariable" query="/bam:bamAuditMessageRequest/bam:bamAuditMessage/bam:IIPForwardedDate"/>
                  </copy>
                  <copy>
                    <from bpelx:language="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0" variable="BamAuditMessageVariable" query="/bam:bamAuditMessageRequest/bam:bamAuditMessage/bam:IIPForwardedDate"/>
                    <to bpelx:language="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0" variable="BamAuditMessageVariable" query="/bam:bamAuditMessageRequest/bam:bamAuditMessage/bam:creationDate"/>
                  </copy>
                  <copy>
                    <from expression="'Exit'"/>
                    <to bpelx:language="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0" variable="BamAuditMessageVariable" query="/bam:bamAuditMessageRequest/bam:bamAuditMessage/bam:IKEAInvocationPoint"/>
                  </copy>
                </assign>
                <assign name="Assign_BAMSensors_trigger" id="BpAss18">
                  <copy>
                    <from bpelx:language="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0" variable="BamAuditMessageVariable"/>
                    <to bpelx:language="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0" variable="BamAuditMessageSensorVariable"/>
                  </copy>
                </assign>
              </sequence>
            </scope>
          </sequence>
        </scope>
      </sequence>
    </scope>
    <scope name="AckScope" variableAccessSerializable="no" id="BpScp8">
      <sequence id="BpSeq16">
        <switch name="Switch1" id="BpSwt0">
          <case condition="bpws:getVariableData('isDESInvocationError')=false()">
            <bpelx:annotation>
              <bpelx:general>
                <bpelx:property name="userLabel">PROCESSED</bpelx:property>
              </bpelx:general>
            </bpelx:annotation>
            <sequence id="BpSeq17">
              <assign name="AssignOK" id="BpAss19">
                <copy>
                  <from bpelx:language="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0" variable="CreateDeliveryScheduleReqMsg" part="parameter" query="/ns7:Transmission/ns7:TransmissionHeader"/>
                  <to bpelx:language="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0" variable="CreateDeliveryScheduleResMsg" part="result" query="/ns7:TransmissionAck/ns7:EchoedTransmissionHeader/ns7:TransmissionHeader"/>
                </copy>
                <copy>
                  <from expression="'PROCESSED'"/>
                  <to bpelx:language="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0" variable="CreateDeliveryScheduleResMsg" part="result" query="/ns7:TransmissionAck/ns7:TransmissionAckStatus"/>
                </copy>
              </assign>
            </sequence>
          </case>
          <otherwise>
            <assign name="AssignReject" id="BpAss20">
              <copy>
                <from bpelx:language="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0" variable="CreateDeliveryScheduleReqMsg" part="parameter" query="/ns7:Transmission/ns7:TransmissionHeader"/>
                <to bpelx:language="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0" variable="CreateDeliveryScheduleResMsg" part="result" query="/ns7:TransmissionAck/ns7:EchoedTransmissionHeader/ns7:TransmissionHeader"/>
              </copy>
              <copy>
                <from expression="'REJECTED'"/>
                <to bpelx:language="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0" variable="CreateDeliveryScheduleResMsg" part="result" query="/ns7:TransmissionAck/ns7:TransmissionAckStatus"/>
              </copy>
              <copy>
                <from expression="'DES ERROR'"/>
                <to bpelx:language="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0" variable="CreateDeliveryScheduleResMsg" part="result" query="/ns7:TransmissionAck/ns7:TransmissionAckReason"/>
              </copy>
            </assign>
          </otherwise>
        </switch>
        <reply name="Reply" variable="CreateDeliveryScheduleResMsg" partnerLink="CreateDeliveryScheduleOTMReqABCS" portType="client:CreateDeliveryScheduleOTMReqABCS" operation="CreateDeliverySchedule" id="BpRpl0"/>
      </sequence>
    </scope>
    <scope name="OTMResponseScope" variableAccessSerializable="no" id="BpScp9">
      <variables>
        <variable name="ErrorText_InputVariable" type="xsd:string"/>
        <variable name="ErrorText_OutputVariable" type="xsd:string"/>
      </variables>
      <sequence name="ProcessShipmentStatus" id="BpSeq18">
        <switch name="Switch2" id="BpSwt1">
          <case condition="ora:countNodes('Invoke_DeliveryScheduleEBS_CreateDeliverySchedule_OutputVariable','CreateDeliveryScheduleResponseEBM','/ns1:CreateDeliveryScheduleResponseEBM/ns1:DataArea/ns1:CreateDeliveryScheduleResponse/ns1:DeliveryScheduleResponse/ns1:DATA/ns1:ERRORS')>0">
            <bpelx:annotation>
              <bpelx:general>
                <bpelx:property name="userLabel">IsDESErrorAvailable</bpelx:property>
              </bpelx:general>
            </bpelx:annotation>
            <sequence name="Exception" id="BpSeq19">
              <assign name="AssignErrorText" id="BpAss21">
                <copy>
                  <from expression="ora:getContentAsString(bpws:getVariableData('Invoke_DeliveryScheduleEBS_CreateDeliverySchedule_OutputVariable','CreateDeliveryScheduleResponseEBM','/ns1:CreateDeliveryScheduleResponseEBM/ns1:DataArea/ns1:CreateDeliveryScheduleResponse/ns1:DeliveryScheduleResponse/ns1:DATA/ns1:ERRORS'))"/>
                  <to variable="ErrorText_InputVariable"/>
                </copy>
              </assign>
              <bpelx:exec name="UpdateErrorString" version="1.5" language="java" id="BxExe15">
                try {                                                      
//Reading Line  
java.lang.String errorVariable = (String)getVariableData("ErrorText_InputVariable");         
errorVariable = errorVariable.replace("&lt;","&amp;lt;");    
errorVariable = errorVariable.replace(">","&amp;gt;");  
errorVariable = errorVariable.replace("curebm:","");  
errorVariable = errorVariable.replace("xmlns:curebm=\"ikea.com/cem/OrderAndDelivery/DeliverySchedule/V0/\"",""); 
setVariableData("ErrorText_OutputVariable",new String(errorVariable));     
}                                                   
catch(Exception e)                                                   
{                                                   
  System.out.println("String Conversion Failed:"+e.getMessage());                                                   
}
              </bpelx:exec>
              <assign name="Xform_CreateDeliveryScheduleErrorMessage" id="BpAss22">
                <bpelx:annotation>
                  <bpelx:pattern>transformation</bpelx:pattern>
                </bpelx:annotation>
                <copy>
                  <from expression="ora:doXSLTransformForDoc('../Transformations/Xform_CreateDeliveryScheduleErrorMsg.xsl', $Invoke_DeliveryScheduleEBS_CreateDeliverySchedule_OutputVariable.CreateDeliveryScheduleResponseEBM, 'CreateDeliveryScheduleReqMsg.parameter', $CreateDeliveryScheduleReqMsg.parameter)"/>
                  <to variable="Invoke_CreateDeliveryScheduleOTMRef_InputVariable" part="parameters"/>
                </copy>
              </assign>
              <assign name="Assign_SenderTransmissionNumber" id="BpAss23">
                <copy>
                  <from expression="xp20:upper-case(ora:getECID())"/>
                  <to bpelx:language="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0" variable="Invoke_CreateDeliveryScheduleOTMRef_InputVariable" part="parameters" query="/ns6:publish/ns7:Transmission/ns7:TransmissionHeader/ns7:SenderTransmissionNo"/>
                </copy>
              </assign>
              <invoke name="Invoke_CreateDeliveryScheduleOTMRef" inputVariable="Invoke_CreateDeliveryScheduleOTMRef_InputVariable" outputVariable="Invoke_CreateDeliveryScheduleOTMRef_OutputVariable" partnerLink="CreateDeliveryScheduleOTMRef1" portType="ns6:TransmissionPortType" operation="publish" bpelx:invokeAsDetail="no" id="BpInv1"/>
            </sequence>
          </case>
          <case condition="ora:countNodes('Invoke_DeliveryScheduleEBS_CreateDeliverySchedule_OutputVariable','CreateDeliveryScheduleResponseEBM','/ns1:CreateDeliveryScheduleResponseEBM/ns1:DataArea/ns1:CreateDeliveryScheduleResponse/ns1:DeliveryScheduleResponse/ns1:DATA/ns1:OutVoSchedulingResponse')>0">
            <bpelx:annotation>
              <bpelx:general>
                <bpelx:property name="userLabel">IsDESResponseAvalable</bpelx:property>
              </bpelx:general>
            </bpelx:annotation>
            <sequence name="SilentResponse" id="BpSeq20">
              <assign name="Xform_CreateDeliveryScheduleResponseMessage_To_CreateDeliveryScheduleResMsg" id="BpAss24">
                <bpelx:annotation>
                  <bpelx:pattern>transformation</bpelx:pattern>
                </bpelx:annotation>
                <copy>
                  <from expression="ora:doXSLTransformForDoc('../Transformations/Xform_CreateDeliveryScheduleResponseMsg.xsl', $Invoke_DeliveryScheduleEBS_CreateDeliverySchedule_OutputVariable.CreateDeliveryScheduleResponseEBM, 'CreateDeliveryScheduleReqMsg.parameter', $CreateDeliveryScheduleReqMsg.parameter)"/>
                  <to variable="Invoke_CreateDeliveryScheduleOTMRef_InputVariable" part="parameters"/>
                </copy>
              </assign>
              <assign name="Assign_SenderTransmissionNumber" id="BpAss25">
                <copy>
                  <from expression="xp20:upper-case(ora:getECID())" bpelx:language="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"/>
                  <to bpelx:language="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0" variable="Invoke_CreateDeliveryScheduleOTMRef_InputVariable" part="parameters" query="/ns6:publish/ns7:Transmission/ns7:TransmissionHeader/ns7:SenderTransmissionNo"/>
                </copy>
              </assign>
              <invoke name="Invoke_CreateDeliveryScheduleOTMRef" inputVariable="Invoke_CreateDeliveryScheduleOTMRef_InputVariable" outputVariable="Invoke_CreateDeliveryScheduleOTMRef_OutputVariable" partnerLink="CreateDeliveryScheduleOTMRef1" portType="ns6:TransmissionPortType" operation="publish" bpelx:invokeAsDetail="no" id="BpInv2"/>
            </sequence>
          </case>
          <otherwise>
            <!--empty name="DoNothing"/-->
            <sequence name="ManualResponse" id="BpSeq21">
              <empty name="DoNothing" id="BpEmp4"/>
            </sequence>
          </otherwise>
        </switch>
        <bpelx:exec name="TraceLog" language="java" version="1.5" id="BxExe16">
          java.lang.Boolean isTrace = (java.lang.Boolean)getVariableData("TraceLogEnabled");   
                     if (isTrace) se.oraclesoa.iip.bpel.functions.Tracer.exitOperate(getVariableData("Title"), getVariableData("InstanceID"), getVariableData("ServiceName"));
        </bpelx:exec>
      </sequence>
    </scope>
    <scope name="ErrorScope" id="BpScp10">
      <switch name="isError" id="BpSwt2">
        <case condition="bpws:getVariableData('IsError')=true()">
          <bpelx:annotation>
            <bpelx:general>
              <bpelx:property name="userLabel">isError</bpelx:property>
            </bpelx:general>
          </bpelx:annotation>
          <scope name="ErrorScope" id="BpScp11">
            <bpelx:annotation>
              <bpelx:general>
                <bpelx:property name="userLabel">ErrorScope</bpelx:property>
              </bpelx:general>
            </bpelx:annotation>
            <sequence name="Sequence_ExecutionFault" id="BpSeq22">
              <assign name="Assign_Error" id="BpAss26">
                <!--copy bpelx:insertMissingToData="yes" bpelx:ignoreMissingFromData="yes">
                                        <from expression="'od.del.itm.DeliverySchedule SS'"/>
                                        <to bpelx:language="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"
                                                        variable="IIPAsyncErrorHandlingProcessRequestMessage" part="FaultMessage"
                                                        query="/corefault:IIPFaultMessage/corefault:IntegrationContractNameVer"/>
                                </copy-->
                <copy bpelx:insertMissingToData="yes" bpelx:ignoreMissingFromData="yes">
                  <from expression="ora:getProcessId()"/>
                  <to variable="IIPAsyncErrorHandlingProcessRequestMessage" part="FaultMessage" query="/corefault:IIPFaultMessage/corefault:FaultingService/corefault:FaultingServiceName"/>
                </copy>
                <copy bpelx:insertMissingToData="yes" bpelx:ignoreMissingFromData="yes">
                  <from bpelx:language="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0" variable="CreateDeliveryScheduleReqMsg" part="parameter"/>
                  <to bpelx:language="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0" variable="IIPAsyncErrorHandlingProcessRequestMessage" part="FaultMessage" query="/corefault:IIPFaultMessage/corefault:SenderMessageReference/corefault:Payload"/>
                </copy>
                <copy bpelx:insertMissingToData="yes" bpelx:ignoreMissingFromData="yes">
                  <from bpelx:language="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0" variable="Invoke_DeliveryScheduleEBS_CreateDeliverySchedule_InputVariable" part="CreateDeliveryScheduleEBM"/>
                  <to bpelx:language="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0" variable="IIPAsyncErrorHandlingProcessRequestMessage" part="FaultMessage" query="/corefault:IIPFaultMessage/corefault:TargetMessageReference/corefault:Payload"/>
                </copy>
                <copy bpelx:insertMissingToData="yes" bpelx:ignoreMissingFromData="yes">
                  <from expression="bpws:getVariableData('CreateDeliveryScheduleReqMsg','parameter','/ns7:Transmission/ns7:TransmissionHeader/ns7:SenderTransmissionNo')" bpelx:language="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"/>
                  <to bpelx:language="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0" variable="IIPAsyncErrorHandlingProcessRequestMessage" part="FaultMessage" query="/corefault:IIPFaultMessage/corefault:TransactionID"/>
                </copy>
                <copy bpelx:insertMissingToData="yes" bpelx:ignoreMissingFromData="yes">
                  <from expression="'SOA'" bpelx:language="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"/>
                  <to variable="IIPAsyncErrorHandlingProcessRequestMessage" part="FaultMessage" query="/corefault:IIPFaultMessage/corefault:FaultingService/corefault:FaultingServiceImplementationType"/>
                </copy>
                <copy bpelx:insertMissingToData="yes" bpelx:ignoreMissingFromData="yes">
                  <from expression="ora:getInstanceId()" bpelx:language="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"/>
                  <to variable="IIPAsyncErrorHandlingProcessRequestMessage" part="FaultMessage" query="/corefault:IIPFaultMessage/corefault:FaultingService/corefault:FaultingServiceInstanceID"/>
                </copy>
                <copy bpelx:insertMissingToData="yes" bpelx:ignoreMissingFromData="yes">
                  <from expression="ora:getECID()" bpelx:language="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"/>
                  <to variable="IIPAsyncErrorHandlingProcessRequestMessage" part="FaultMessage" query="/corefault:IIPFaultMessage/corefault:ECID"/>
                </copy>
                <copy bpelx:insertMissingToData="yes" bpelx:ignoreMissingFromData="yes">
                  <from expression="ora:getFlowId()"/>
                  <to bpelx:language="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0" variable="IIPAsyncErrorHandlingProcessRequestMessage" part="FaultMessage" query="/corefault:IIPFaultMessage/corefault:InstanceID"/>
                </copy>
                <copy bpelx:insertMissingToData="yes" bpelx:ignoreMissingFromData="yes">
                  <from expression="'ITM'"/>
                  <to bpelx:language="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0" variable="IIPAsyncErrorHandlingProcessRequestMessage" part="FaultMessage" query="/corefault:IIPFaultMessage/corefault:AlertSystemEndpointID"/>
                </copy>
                <copy bpelx:insertMissingToData="yes" bpelx:ignoreMissingFromData="yes">
                  <from expression="'IIP'"/>
                  <to bpelx:language="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0" variable="IIPAsyncErrorHandlingProcessRequestMessage" part="FaultMessage" query="/corefault:IIPFaultMessage/corefault:SourceSystem"/>
                </copy>
                <copy bpelx:insertMissingToData="yes" bpelx:ignoreMissingFromData="yes">
                  <from expression="'DES'"/>
                  <to bpelx:language="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0" variable="IIPAsyncErrorHandlingProcessRequestMessage" part="FaultMessage" query="/corefault:IIPFaultMessage/corefault:TargetSystem"/>
                </copy>
                <copy bpelx:insertMissingToData="yes" bpelx:ignoreMissingFromData="yes">
                  <from expression="'CreateDeliverySchedule'"/>
                  <to bpelx:language="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0" variable="IIPAsyncErrorHandlingProcessRequestMessage" part="FaultMessage" query="/corefault:IIPFaultMessage/corefault:OperationName"/>
                </copy>
                <copy bpelx:insertMissingToData="yes" bpelx:ignoreMissingFromData="yes">
                  <from expression="oraext:generate-guid()"/>
                  <to bpelx:language="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0" variable="IIPAsyncErrorHandlingProcessRequestMessage" part="FaultMessage" query="/corefault:IIPFaultMessage/corefault:GUID"/>
                </copy>
                <copy bpelx:insertMissingToData="yes" bpelx:ignoreMissingFromData="yes">
                  <from expression="xp20:current-dateTime()"/>
                  <to bpelx:language="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0" variable="IIPAsyncErrorHandlingProcessRequestMessage" part="FaultMessage" query="/corefault:IIPFaultMessage/corefault:ReportDateTime"/>
                </copy>
                <copy bpelx:insertMissingToData="yes" bpelx:ignoreMissingFromData="yes">
                  <from expression="'E'"/>
                  <to bpelx:language="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0" variable="IIPAsyncErrorHandlingProcessRequestMessage" part="FaultMessage" query="/corefault:IIPFaultMessage/corefault:ErrorContext/corefault:SeverityLevel"/>
                </copy>
                <copy bpelx:insertMissingToData="yes" bpelx:ignoreMissingFromData="yes">
                  <from expression="'7200'"/>
                  <to bpelx:language="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0" variable="IIPAsyncErrorHandlingProcessRequestMessage" part="FaultMessage" query="/corefault:IIPFaultMessage/corefault:ErrorContext/corefault:ExpirationTime"/>
                </copy>
                <copy bpelx:insertMissingToData="yes" bpelx:ignoreMissingFromData="yes">
                  <from expression="bpws:getVariableData('CreateDeliveryScheduleReqMsg','parameter','/ns7:Transmission/ns7:TransmissionHeader/ns7:SenderTransmissionNo')" bpelx:language="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"/>
                  <to bpelx:language="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0" variable="IIPAsyncErrorHandlingProcessRequestMessage" part="FaultMessage" query="/corefault:IIPFaultMessage/corefault:SenderMessageReference/corefault:MessageID"/>
                </copy>
                <copy bpelx:insertMissingToData="yes" bpelx:ignoreMissingFromData="yes">
                  <from expression="bpws:getVariableData('CreateDeliveryScheduleReqMsg','parameter','/ns7:Transmission/ns7:TransmissionHeader/ns7:SenderTransmissionNo')" bpelx:language="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"/>
                  <to bpelx:language="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0" variable="IIPAsyncErrorHandlingProcessRequestMessage" part="FaultMessage" query="/corefault:IIPFaultMessage/corefault:SenderMessageReference/corefault:ObjectReferenceID"/>
                </copy>
                <copy bpelx:insertMissingToData="yes" bpelx:ignoreMissingFromData="yes">
                  <from expression="bpws:getVariableData('CreateDeliveryScheduleReqMsg','parameter','/ns7:Transmission/ns7:TransmissionHeader/ns7:SenderTransmissionNo')" bpelx:language="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"/>
                  <to bpelx:language="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0" variable="IIPAsyncErrorHandlingProcessRequestMessage" part="FaultMessage" query="/corefault:IIPFaultMessage/corefault:TargetMessageReference/corefault:MessageID"/>
                </copy>
                <copy bpelx:insertMissingToData="yes" bpelx:ignoreMissingFromData="yes">
                  <from expression="bpws:getVariableData('CreateDeliveryScheduleReqMsg','parameter','/ns7:Transmission/ns7:TransmissionHeader/ns7:SenderTransmissionNo')" bpelx:language="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"/>
                  <to bpelx:language="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0" variable="IIPAsyncErrorHandlingProcessRequestMessage" part="FaultMessage" query="/corefault:IIPFaultMessage/corefault:TargetMessageReference/corefault:ObjectReferenceID"/>
                </copy>
              </assign>
              <scope name="BAMScope" bpelx:skipCondition="ora:getPreference('reportToBAM')='false'" id="BpScp12">
                <faultHandlers id="BpFhs5">
                  <catchAll id="BpCAl5">
                    <empty name="Empty" id="BpEmp5"/>
                  </catchAll>
                </faultHandlers>
                <sequence name="BAMSequence" id="BpSeq23">
                  <assign name="Assign_BAMSensor_InputData" id="BpAss27">
                    <copy>
                      <from expression="'IIP'"/>
                      <to bpelx:language="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0" variable="BamAuditMessageVariable" query="/bam:bamAuditMessageRequest/bam:bamAuditMessage/bam:source"/>
                    </copy>
                    <copy>
                      <from expression="'ITM'" bpelx:language="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"/>
                      <to bpelx:language="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0" variable="BamAuditMessageVariable" query="/bam:bamAuditMessageRequest/bam:bamAuditMessage/bam:target"/>
                    </copy>
                    <copy>
                      <from expression="'ABCSRequestorRes'"/>
                      <to bpelx:language="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0" variable="BamAuditMessageVariable" query="/bam:bamAuditMessageRequest/bam:bamAuditMessage/bam:sourceType"/>
                    </copy>
                    <copy>
                      <from expression="'Failed'"/>
                      <to bpelx:language="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0" variable="BamAuditMessageVariable" query="/bam:bamAuditMessageRequest/bam:bamAuditMessage/bam:status"/>
                    </copy>
                    <copy>
                      <from expression="''"/>
                      <to bpelx:language="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0" variable="BamAuditMessageVariable" query="/bam:bamAuditMessageRequest/bam:bamAuditMessage/bam:IIPReceivedDate"/>
                    </copy>
                    <copy>
                      <from expression="xp20:current-dateTime()"/>
                      <to bpelx:language="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0" variable="BamAuditMessageVariable" query="/bam:bamAuditMessageRequest/bam:bamAuditMessage/bam:IIPForwardedDate"/>
                    </copy>
                    <copy>
                      <from bpelx:language="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0" variable="BamAuditMessageVariable" query="/bam:bamAuditMessageRequest/bam:bamAuditMessage/bam:IIPForwardedDate"/>
                      <to bpelx:language="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0" variable="BamAuditMessageVariable" query="/bam:bamAuditMessageRequest/bam:bamAuditMessage/bam:creationDate"/>
                    </copy>
                    <copy>
                      <from expression="'Exit'"/>
                      <to bpelx:language="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0" variable="BamAuditMessageVariable" query="/bam:bamAuditMessageRequest/bam:bamAuditMessage/bam:IKEAInvocationPoint"/>
                    </copy>
                  </assign>
                  <assign name="Assign_BAMSensors_trigger" id="BpAss28">
                    <copy>
                      <from bpelx:language="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0" variable="BamAuditMessageVariable"/>
                      <to bpelx:language="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0" variable="BamAuditMessageSensorVariable"/>
                    </copy>
                  </assign>
                </sequence>
              </scope>
              <invoke name="Invoke_IIPAsyncErrorHandlingProcess" partnerLink="IIPAsyncErrorHandlingProcess" portType="ikeaeh:IIPAsyncErrorHandlingProcess" operation="notify" inputVariable="IIPAsyncErrorHandlingProcessRequestMessage" id="BpInv3"/>
              <bpelx:exec name="TraceLog" language="java" version="1.5" id="BxExe17">
                java.lang.Boolean isTrace = (java.lang.Boolean)getVariableData("TraceLogEnabled");   
			if (isTrace) se.oraclesoa.iip.bpel.functions.Tracer.traceFault("ErrorHandler",getVariableData("Title"), getVariableData("InstanceID"), getVariableData("ServiceName"));
              </bpelx:exec>
            </sequence>
          </scope>
        </case>
      </switch>
    </scope>
  </sequence>
</process>